
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="./lib/react.development.js"></script>
    <script src="./lib/react-dom.development.js"></script>
    <script src="./lib/babel.min.js"></script>
    <style>
        .boy {
            border: solid 5px red;
            width: 300px;
            height: 300px;
        }

        .girl {
            border: solid 5px green;
            width: 300px;
            height: 300px;
        }

        .msg {
            height: 30px;
        }

        .me {
            float: right;
        }
    </style>
</head>
<body>
<div id="app"></div>

<script>

    class Events {
        constructor() {
            this.callbackContainer = {};
            // this.callbackContainer = {
            //     'æˆ‘é¥¿äº†': [
            //         function() {},
            //         function() {},
            //     ],
            //     'æˆ‘æ¸´äº†': [
            //         function() {},
            //         function() {},
            //     ]
            // };
        }
        on(eventName, callback) {

            if (!this.callbackContainer[eventName]) {
                // ç¬¬ä¸€æ¬¡ eventName æ‰€å¯¹åº”çš„ å›è°ƒå‡½æ•° æ•°ç»„ä¸å­˜åœ¨, é‚£ä¹ˆ é€ ä¸€ä¸ª
                this.callbackContainer[eventName] = [];
            }

            this.callbackContainer[eventName].push(callback)
        }

        emit(eventName, data) {
            const callback_list = this.callbackContainer[eventName];
            if (callback_list) {
                for (let callback of callback_list) {
                    callback(data);
                }
            }
        }
    }


    // const events = new Events();

    // events.on('æˆ‘é¥¿äº†', function (food) {
    //     console.log('åƒç‚¹ ' + food);
    // });

    // events.emit('æˆ‘é¥¿äº†', 'ğŸ—')


</script>


<script type="text/babel">

    const events = new Events();

    class Boy extends React.Component {
        constructor(props) {
            super(props);
            this.boyRef = React.createRef();
            // this.state = {
            //     msg_list: [
            //         {text: 'åœ¨å—?', sender: 'æˆ‘'},
            //         {text: 'å›°äº†.', sender: 'éŸ©æ¢…æ¢…'}
            //     ]
            // }
            this.state = {
                msg_list: []
            }

            events.on('å¥³å­©è¯´', (msg) => {
                const { msg_list } = this.state;
                msg_list.push(msg);
                this.setState({
                    msg_list
                })
            });
        }

        say = () => {
            const text = this.boyRef.current.value;
            events.emit('ç”·å­©è¯´', {text, sender: this.props.name});

            const {msg_list} = this.state;
            msg_list.push({text, sender: 'æˆ‘'})

            this.setState({
                msg_list
            })
        }

        render() {
            const { msg_list } = this.state;

            const div_list = msg_list.map((msg, index) => {
                return (
                    <div key={index} className="msg"> 
                        <div className={ msg.sender === 'æˆ‘' ? 'me': '' }>
                            { msg.sender } è¯´: { msg.text } 
                        </div>
                    </div>
                )
            });

            return (
                <div className="boy">
                    ç”·å­©: <input ref={this.boyRef} /> <button onClick={ this.say }>å‘é€</button>
                    <hr/>
                    <div>
                        { div_list }
                    </div>
                </div>
            )
        }
    }

    class Girl extends React.Component {
        constructor(props) {
            super(props);

            this.girlRef = React.createRef();

            this.state = {
                msg_list: []
            }

            events.on('ç”·å­©è¯´', (msg) => {
                const {msg_list} = this.state;
                msg_list.push(msg);
                this.setState({
                    msg_list
                })
            })
        }
        // è¿™æ ·å†™å¯ä¸€ä¸ª ä¿è¯ this æŒ‡å‘
        say = () => {
            // this.girlRef.current ä»£è¡¨äº† input æ¡†
            let text = this.girlRef.current.value;
            events.emit('å¥³å­©è¯´', {text: text, sender: this.props.name});
            
            const { msg_list } = this.state;
            msg_list.push({ text: text, sender: 'æˆ‘'});
            this.setState({
                msg_list
            })
        }

        render() {
            const { msg_list } = this.state;

            const div_list = msg_list.map((msg, index) => {
                return (
                    <div key={index} className="msg"> 
                        <div className={ msg.sender === 'æˆ‘' ? 'me': '' }>
                            { msg.sender } è¯´: { msg.text } 
                        </div>
                    </div>
                )
            });

            return (
                <div className="girl">
                    å¥³å­©: <input ref={this.girlRef} /> <button onClick={ this.say }>å‘é€</button>
                    <hr/>
                    <div>
                        { div_list }
                    </div>
                </div>
            )
        }
    }

    ReactDOM.render(
        <div>
            <Boy name="æç£Š"/>
            <hr/>
            <Girl name="éŸ©æ¢…æ¢…" />
        </div>,
        document.getElementById('app')
    );
    
    
</script>
</body>
</html>
